<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Secular+One&display=swap" rel="stylesheet">

<script src="{{url_for('static', filename='sky-sphere.min.js')}}"></script> 
<script src="{{url_for('static', filename='search.js')}}"></script> 

<style type="text/css">
/* GLOBAL */
nav {
	padding: 32px;
}

h1 {
	margin: 0px;
	margin-bottom: 8px;

	font-family: 'Secular One', sans-serif;
	font-size: 2.5rem;
	line-height: 2.5rem;

	color: #0652DD;
}

h2 {
	margin: 0px;

	font-family: 'Secular One', sans-serif;
	letter-spacing: 4px;
}

h3 {
	margin: 0px;
	margin-bottom: 8px;

	font-family: 'Secular One', sans-serif;
}

p {
	margin: 0px;
	font-family: 'Noto Sans JP', sans-serif;
}

.card-container {
	padding: 32px;
	padding-top: 0px;
}

.card-a, .card-a:visited, .card-a:hover {
	text-decoration: none;
	appearance: none;
	-moz-appearance: none;
	-webkit-appearance: none;
	color: #000000;
}

.data-card {
	position: relative;

	padding: 32px;
	border: 1.5px solid #f1f2f6;
	border-radius: 12px;
	margin-bottom: 16px;

	-webkit-transition: all 0.1s ease-in-out;
	-moz-transition: all 0.1s ease-in-out;
	-ms-transition: all 0.1s ease-in-out;
	-o-transition: all 0.1s ease-in-out;
	transition: all 0.1s ease-in-out;
}

.data-card:hover {
	-webkit-box-shadow: 0px 0px 36px -6px #f1f2f6BF;
	-moz-box-shadow: 0px 0px 36px -6px #f1f2f6BF;
	box-shadow: 0px 0px 36px -6px #f1f2f6BF;

	cursor: pointer;

	-webkit-transition: all 0.1s ease-in-out;
	-moz-transition: all 0.1s ease-in-out;
	-ms-transition: all 0.1s ease-in-out;
	-o-transition: all 0.1s ease-in-out;
	transition: all 0.1s ease-in-out;
}

.image-download {
	padding: 8px;

	position: absolute;
	top: 50%;
	right: 32px;
	transform: translateY(-50%);

	font-family: 'Secular One', sans-serif;
	letter-spacing: 2px;
	text-decoration: none;
	color: #0652DD;

	border-radius: 8px;

	-webkit-transition: all 0.1s ease-in-out;
	-moz-transition: all 0.1s ease-in-out;
	-ms-transition: all 0.1s ease-in-out;
	-o-transition: all 0.1s ease-in-out;
	transition: all 0.1s ease-in-out;
}

.image-download:hover {
	background: #f1f2f6;

	-webkit-transition: all 0.1s ease-in-out;
	-moz-transition: all 0.1s ease-in-out;
	-ms-transition: all 0.1s ease-in-out;
	-o-transition: all 0.1s ease-in-out;
	transition: all 0.1s ease-in-out;
}

.image-icon {
	width: 28px;
	height: 28px;

	vertical-align: bottom;
	margin-left: 8px;
}

/* BUTTON */
.button {
  padding: 15px 25px;
  font-size: 24px;
  text-align: center;
  cursor: pointer;
  outline: none;
  color: #fff;
  background-color: #0652DD;
  border: none;
  border-radius: 15px;
  box-shadow: 0 9px #999;
}

.button:hover {background-color: #013dac}

.button:active {
  background-color: #013dac;
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}

/* SKY SPHERE */
.centered-div {
	margin: 0 auto;
	text-align: center;
}

.display-info-card {
	width: 800px;
	text-align: left;
	margin: 0 auto;
}

#sky {
	margin: 0 auto;
	display: block;
}

* {
	box-sizing: border-box;
}
</style>

<body>

	<nav>
		<h2>BIG SKY</h2>
    	<h1>HEASARC and NEOSSat Data Viewer</h1>
	</nav>

	<div class="centered-div" style="margin-bottom: 32px;">
		<h2>SKY SPHERE</h2>
		<canvas id="sky"></canvas>

		<div class="display-info-card">
			<div class="data-card">
				<h3 id="object-name">NAME</h3>
				<p>Date Observed</p>
				<p>"Actual Ra at Start of Exposure: - </p>
				<p>"Actual Dec at Start of Exposure: - </p>
				<a class="image-download" href="href">DOWNLOAD IMAGE<img class="image-icon" src="{{url_for('static', filename='image-icon.png')}}"/></a>
			</div>
    	</div>
	</div>

    <div class="card-container">
		<form action="/search" style="text-align: center;">
			<button class="button" type="submit">
				<h2>HEASARC SEARCH</h2>
			</button>
		</form>
	</div>
	
	<div class="centered-div">
		<h2 style="margin-bottom: 16px;">LIST OF ALL OBJECTS</h2>
	</div>
    <div class="card-container">
		{% for obj in test_obj %}
			<a class="card-a" href="/detail?datetime={{ obj['FITSImage']['ImagingSpecification']['DateOfObservation'] }}">
				<div class="data-card">
					<h3>{{ obj['FITSImage']['Image']['PrimeObjectName'] }}</h3>
					<p>{{ obj['FITSImage']['ImagingSpecification']['DateOfObservation'] }}</p>
					<p>{{ obj['FITSImage']['Attitude'] }}</p>
					<a class="image-download" href="{{ obj['FITSImage']['Image']['ImageFile'] }}">DOWNLOAD IMAGE<img class="image-icon" src="{{url_for('static', filename='image-icon.png')}}"/></a>
				</div>
			</a>
		{% endfor %}
    </div>

</body>

<script type="text/javascript">
	
var sky = new SkySphere('sky', {
	    width: 800,
	    height: 400,
	    customOnClick: function(data) {
	        document.getElementById("object-name").innerHTML = data.clickData.FITSImage.Image.PrimeObjectName
	    },
	    getObjectText: function (data) {
			return data.name;
        }
	});
	//So, for example, if RA is 15h29m18s the value to use is 15 + 29 / 60 + 18 / 3600 = 15.488333.
	var all_objects = '{{ test_obj | tojson }}'
	console.log(all_objects)
	var all_objects_parsed = JSON.parse(all_objects)
	console.log(all_objects_parsed)

	for (var i = 0; i < all_objects_parsed.length; i++) {
		console.log("I is " + i)
		console.log(all_objects_parsed.length)
		console.log(all_objects_parsed[i].FITSImage.Attitude.ActualRaAtStartOfExposure)

		var ra = all_objects_parsed[i].FITSImage.Attitude.ActualRaAtStartOfExposure
		var dec = all_objects_parsed[i].FITSImage.Attitude.ActualDecAtStartOfExposure
		var name= all_objects_parsed[i].FITSImage.Image.PrimeObjectName

		var numberOfWhitespace = 0

		var one = ""
		var two = ""
		var three = ""

		for (var a = 0; a < ra.length; a++) {
			if (ra.charAt(a) == ' ') {
				numberOfWhitespace += 1
				console.log("Char is whitespace")
			}

			if (numberOfWhitespace < 1) {
				one += ra.charAt(a)
				console.log("Adding to one - " + ra.charAt(a))
			} else if (numberOfWhitespace == 1) {
				two += ra.charAt(a)
				console.log("Adding to two - " + ra.charAt(a))
			} else if (numberOfWhitespace == 2) {
				three += ra.charAt(a)
				console.log("Adding to three - " + ra.charAt(a))
			} else {
				console.log("numberOfWhitespace is " + numberOfWhitespace)
			}
		}

		var done = ""
		var dtwo = ""
		var dthree = ""

		var dnumberOfWhitespace = 0

		for (var a = 0; a < dec.length; a++) {
			if (dec.charAt(i) == ' ') {
				dnumberOfWhitespace += 1
				console.log("Char is whitespace")
			}

			if (dnumberOfWhitespace < 1) {
				one += dec.charAt(a)
				console.log("Adding to one - " + dec.charAt(a))
			} else if (dnumberOfWhitespace == 1) {
				two += dec.charAt(a)
				console.log("Adding to two - " + dec.charAt(a))
			} else if (dnumberOfWhitespace == 2) {
				three += dec.charAt(a)
				console.log("Adding to three - " + dec.charAt(a))
			} else {
				console.log("numberOfWhitespace is " + dnumberOfWhitespace)
			}
		}


		var standard_ra_conversion = parseFloat(one) + (parseFloat(two) / 60) + (parseFloat(three) / 3600)
		var standard_dec_conversion = parseFloat(one) + (parseFloat(two) / 60) + (parseFloat(three) / 3600)
		console.log("Ra" + standard_ra_conversion)

		console.log("Dec" + standard_dec_conversion)

		sky.addCustomObject(standard_ra_conversion, standard_dec_conversion, {
			name: name,
			clickData: all_objects_parsed[i],
			color: '#25CCF7',
			radius: 10,
		});
	}

	/*var ra = all_objects_parsed[0].FITSImage.Attitude.ActualRaAtStartOfExposure
	var dec = all_objects_parsed[0].FITSImage.Attitude.ActualDecAtStartOfExposure

	var numberOfWhitespace = 0

	var one = ""
	var two = ""
	var three = ""

	for (var i = 0; i < ra.length; i++) {
		if (ra.charAt(i) == ' ') {
			numberOfWhitespace += 1
			console.log("Char is whitespace")
		}

		if (numberOfWhitespace < 1) {
			one += ra.charAt(i)
			console.log("Adding to one - " + ra.charAt(i))
		} else if (numberOfWhitespace == 1) {
			two += ra.charAt(i)
			console.log("Adding to two - " + ra.charAt(i))
		} else if (numberOfWhitespace == 2) {
			three += ra.charAt(i)
			console.log("Adding to three - " + ra.charAt(i))
		} else {
			console.log("numberOfWhitespace is " + numberOfWhitespace)
		}
	}

	var done = ""
	var dtwo = ""
	var dthree = ""

	var dnumberOfWhitespace = 0

	for (var i = 0; i < dec.length; i++) {
		if (dec.charAt(i) == ' ') {
			dnumberOfWhitespace += 1
			console.log("Char is whitespace")
		}

		if (dnumberOfWhitespace < 1) {
			one += dec.charAt(i)
			console.log("Adding to one - " + dec.charAt(i))
		} else if (dnumberOfWhitespace == 1) {
			two += dec.charAt(i)
			console.log("Adding to two - " + dec.charAt(i))
		} else if (dnumberOfWhitespace == 2) {
			three += dec.charAt(i)
			console.log("Adding to three - " + dec.charAt(i))
		} else {
			console.log("numberOfWhitespace is " + dnumberOfWhitespace)
		}
	}


	var standard_ra_conversion = parseFloat(one) + (parseFloat(two) / 60) + (parseFloat(three) / 3600)
	var standard_dec_conversion = parseFloat(one) + (parseFloat(two) / 60) + (parseFloat(three) / 3600)
	console.log("Ra" + standard_ra_conversion)

	console.log("Dec" + standard_dec_conversion)

	var sky = new SkySphere('sky', {
	    width: 800,
	    height: 400,
	    customOnClick: function(data) {
	        document.getElementById("object-name").innerHTML = data.name
	    },
	    getObjectText: function (data) {
			return data.name;
        }
	});

	sky.addCustomObject(standard_ra_conversion, standard_dec_conversion, {
		name: all_objects_parsed[0].FITSImage.Image.PrimeObjectName,
		clickData: 'Object',
		color: '#25CCF7',
		radius: 10,
	});*/

	/*for (object in all_objects_parsed) {
		var ra = object.Attitude
		console.log(ra)
	}*/

	sky.addCustomObject(3.58814, -4.92319, {
		name: 'Sun',
		clickData: 'Sun',
		color: '#ffe400',
		radius: 10
	});

	sky.drawSky();
</script>

